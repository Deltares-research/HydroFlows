config:
  sfincs_exe: bin/sfincs/sfincs.exe
  fiat_exe: bin/fiat/fiat
  region: data/test_region.geojson
  rps: [5, 10, 50]

rules:
  - method: sfincs_build
    kwargs:
      region: $config.region
  - method: fiat_build
    kwargs:
      region: $rules.sfincs_build.output.sfincs_region
  - method: get_ERA5_rainfall
    kwargs:
      region: $rules.sfincs_build.output.sfincs_region
  - method: pluvial_design_events
    kwargs:
      precip_nc: $rules.get_ERA5_rainfall.output.precip_nc
      rps: $config.rps
  - method: sfincs_update_forcing
    kwargs:
      sfincs_inp: $rules.sfincs_build.output.sfincs_inp
      event_yaml: $rules.pluvial_design_events.output.event_yaml
  - method: sfincs_run
    kwargs:
      sfincs_inp: $rules.sfincs_update_forcing.output.sfincs_out_inp
      sfincs_exe: $config.sfincs_exe
  - method: sfincs_postprocess
    kwargs:
      sfincs_map: $rules.sfincs_run.output.sfincs_map
      sfincs_subgrid_dep: $rules.sfincs_build.output.sfincs_subgrid_dep
  - method: fiat_update_hazard
    kwargs:
      fiat_cfg: $rules.fiat_build.output.fiat_cfg
      event_set_yaml: $rules.pluvial_design_events.output.event_set
      hazard_maps: $rules.sfincs_postprocess.output.hazard_tif
  - method: fiat_run
    kwargs:
      fiat_cfg: $rules.fiat_update_hazard.output.fiat_out_cfg
      fiat_bin: $config.fiat_exe
